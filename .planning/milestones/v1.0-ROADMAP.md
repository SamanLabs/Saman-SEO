# Milestone v1.0: Schema Engine

**Status:** ✅ SHIPPED 2026-01-23
**Phases:** 1-6
**Total Plans:** 14

## Overview

This roadmap transformed the Saman SEO plugin's hardcoded JSON-LD implementation into an extensible, registry-based schema engine. We built the core architecture (registry, base class, graph manager), then layered on schema types in order of Google rich results impact: content schemas (Article variants), interactive schemas (FAQ/HowTo with block integration), and LocalBusiness. Finally, we added admin UI for configuration and a developer API for third-party extension.

## Phases

### Phase 1: Schema Engine Foundation

**Goal**: Establish the extensible architecture that all schema types will use
**Depends on**: Nothing (first phase)
**Plans**: 3 plans

Plans:
- [x] 01-01-PLAN.md - Core schema infrastructure (Abstract_Schema, Schema_Context, Schema_IDs)
- [x] 01-02-PLAN.md - Registry and Graph Manager (Schema_Registry, Schema_Graph_Manager)
- [x] 01-03-PLAN.md - Migration (WebSite, WebPage, Breadcrumb, Organization, Person schemas + wiring)

**Details:**
- Schema_Registry singleton with priority-based registration
- Abstract_Schema base class with abstract methods for generate(), is_needed(), get_type()
- Schema_Context value object with factory methods from_current() and from_post()
- Schema_IDs helper for consistent URL#fragment identifiers
- Schema_Graph_Manager combining schemas into @graph with @context at root only
- Legacy filter preserved for backward compatibility

### Phase 2: Content Schemas

**Goal**: Users get enhanced Article schemas that improve Google rich results eligibility
**Depends on**: Phase 1
**Plans**: 2 plans

Plans:
- [x] 02-01-PLAN.md - Article_Schema base class with author Person, wordCount, articleBody
- [x] 02-02-PLAN.md - BlogPosting and NewsArticle extensions + registry

**Details:**
- Article_Schema with full Person author object (not just name string)
- Automatic wordCount and articleBody excerpt
- BlogPosting minimal subclass (inherits everything, changes only @type)
- NewsArticle with dateline auto-generation from SAMAN_SEO_local_city
- Priority 15 for content schemas

### Phase 3: Interactive Schemas

**Goal**: FAQ and HowTo blocks generate valid, complete schemas automatically
**Depends on**: Phase 1
**Plans**: 2 plans

Plans:
- [x] 03-01-PLAN.md - FAQPage schema with block parsing and registry integration
- [x] 03-02-PLAN.md - HowTo schema with block parsing and registry integration

**Details:**
- FAQPage_Schema parses blocks from post_content via parse_blocks()
- Multiple FAQ blocks combine into single mainEntity array
- HowTo_Schema uses first block only with showSchema=true
- Recursive extraction handles blocks nested in columns/groups
- Time parsing supports minutes and hours, converts to ISO 8601
- Inline schema removed from blocks (registry is sole source)
- Priority 18 for interactive schemas

### Phase 4: LocalBusiness Schema

**Goal**: LocalBusiness schema pulls from existing Local SEO settings automatically
**Depends on**: Phase 1
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md - LocalBusiness_Schema class with Schema_IDs method
- [x] 04-02-PLAN.md - Registry integration and legacy filter removal

**Details:**
- LocalBusiness_Schema outputs only on homepage (matches Organization pattern)
- Address requires street + city for PostalAddress output
- Opening hours grouped by identical times for compact output
- GeoCoordinates with float-cast latitude/longitude
- All 17 SAMAN_SEO_local_* options integrated
- Legacy filters commented out (not deleted) when migrating
- Priority 5 (after Organization, before WebPage)

### Phase 5: Admin UI

**Goal**: Users can configure and preview schemas through the WordPress admin
**Depends on**: Phase 1, Phase 2
**Plans**: 3 plans

Plans:
- [x] 05-01-PLAN.md - REST API endpoint and post meta schema_type persistence
- [x] 05-02-PLAN.md - Editor sidebar Schema tab with type selector and live preview
- [x] 05-03-PLAN.md - Search Appearance post type schema defaults

**Details:**
- Schema_Preview_Controller with edit_post permission for editor access
- Post type schema_type settings use SAMAN_SEO_post_type_settings option
- Schema preview uses 500ms debounce to avoid API spam
- Preview refreshes on both schema_type changes and content changes
- SchemaTypeSelector and SchemaPreview React components
- useSchemaPreview hook with AbortController cleanup

### Phase 6: Developer API

**Goal**: Developers can extend the schema system with custom types and modifications
**Depends on**: Phase 1, Phase 2, Phase 3, Phase 4
**Plans**: 2 plans

Plans:
- [x] 06-01-PLAN.md - Add registration action hook and fields filter
- [x] 06-02-PLAN.md - Create Schema Developer API documentation

**Details:**
- saman_seo_register_schema_type action fires after core schemas but before services
- saman_seo_schema_{type}_fields filter method is optional for concrete classes
- Dynamic filter name uses lowercase schema type
- Documentation follows existing FILTERS.md format
- Five complete examples cover most common use cases (Event, Recipe, Product, Speakable, conditional)
- 1,368-line SCHEMA_DEVELOPER_API.md with troubleshooting guide

---

## Milestone Summary

**Decimal Phases:**
None — milestone completed without urgent insertions.

**Key Decisions:**
- Schema_IDs uses static methods for dynamic URL generation (not constants)
- Schema_Context.schema_type priority: post meta > post type settings > Article default
- Registry uses singleton pattern for WordPress plugin compatibility
- Graph_Manager receives registry via constructor injection for testability
- @context added ONLY in Graph_Manager root, never in individual pieces
- Legacy JsonLD methods marked @deprecated but kept for third-party compatibility
- Author is full Person object (not name string) for Google rich results eligibility
- FAQPage combines multiple blocks; HowTo uses first block only
- LocalBusiness outputs only on homepage
- Fields filter is optional (concrete classes call if needed)

**Issues Resolved:**
- Hardcoded JSON-LD replaced with extensible registry
- No per-post schema configuration → Editor sidebar with type selector
- No schema preview → Live JSON-LD preview with debounce
- No developer extension points → 4 public hooks with documentation

**Issues Deferred:**
- VideoObject schema (requires media detection complexity)
- Recipe schema (requires ingredient/instruction parsing)
- WooCommerce Product schema (dedicated e-commerce milestone)
- Built-in schema.org validation (live preview sufficient for v1)

**Technical Debt Incurred:**
- None identified — clean architecture implemented

---

_For current project status, see .planning/ROADMAP.md_

---

_Archived: 2026-01-23 as part of v1.0 milestone completion_
