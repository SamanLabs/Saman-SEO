---
phase: 02-content-schemas
plan: 02
type: execute
wave: 2
depends_on: [02-01]
files_modified:
  - includes/Schema/Types/class-blogposting-schema.php
  - includes/Schema/Types/class-newsarticle-schema.php
  - includes/class-saman-seo-plugin.php
autonomous: true

must_haves:
  truths:
    - "User can select BlogPosting as schema type and output uses BlogPosting @type"
    - "User can select NewsArticle as schema type and output includes dateline"
    - "User can select NewsArticle as schema type and output includes printSection"
    - "Article, BlogPosting, NewsArticle are registered in schema registry"
    - "Content schemas have priority 15 (after WebPage at 10, before Breadcrumb at 20)"
  artifacts:
    - path: "includes/Schema/Types/class-blogposting-schema.php"
      provides: "BlogPosting_Schema extending Article_Schema"
      contains: "class BlogPosting_Schema extends Article_Schema"
      min_lines: 30
    - path: "includes/Schema/Types/class-newsarticle-schema.php"
      provides: "NewsArticle_Schema extending Article_Schema with dateline/printSection"
      contains: "class NewsArticle_Schema extends Article_Schema"
      min_lines: 60
    - path: "includes/class-saman-seo-plugin.php"
      provides: "Registry entries for Article, BlogPosting, NewsArticle"
      contains: "article.*Article_Schema"
  key_links:
    - from: "includes/Schema/Types/class-blogposting-schema.php"
      to: "includes/Schema/Types/class-article-schema.php"
      via: "extends Article_Schema"
      pattern: "extends Article_Schema"
    - from: "includes/Schema/Types/class-newsarticle-schema.php"
      to: "includes/Schema/Types/class-article-schema.php"
      via: "extends Article_Schema"
      pattern: "extends Article_Schema"
    - from: "includes/class-saman-seo-plugin.php"
      to: "Schema_Registry"
      via: "register() calls"
      pattern: "register.*article"
---

<objective>
Create BlogPosting and NewsArticle schema types extending Article_Schema, and register all content schemas in the plugin.

Purpose: BlogPosting is a minimal extension (changes only @type). NewsArticle adds dateline and printSection properties for news content. Registration makes these types available for selection in post meta and post type settings.

Output: Two new schema type classes and registry entries for Article, BlogPosting, NewsArticle.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-content-schemas/02-RESEARCH.md
@.planning/phases/02-content-schemas/02-01-SUMMARY.md

# Phase 2 Plan 1 output
@includes/Schema/Types/class-article-schema.php

# Registration pattern from Phase 1
@includes/class-saman-seo-plugin.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BlogPosting_Schema</name>
  <files>includes/Schema/Types/class-blogposting-schema.php</files>
  <action>
Create BlogPosting_Schema extending Article_Schema. This is a minimal subclass - BlogPosting inherits everything from Article except the @type value.

**File structure:**
```php
<?php
/**
 * BlogPosting Schema class.
 *
 * Generates BlogPosting schema for blog posts.
 * Extends Article_Schema, changing only the @type value.
 *
 * @package Saman\SEO\Schema\Types
 * @since   1.0.0
 */

namespace Saman\SEO\Schema\Types;

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

/**
 * BlogPosting schema type.
 *
 * Outputs BlogPosting structured data. Inherits all properties
 * from Article_Schema; only differs in @type value.
 */
class BlogPosting_Schema extends Article_Schema {

    /**
     * Get the schema @type value.
     *
     * @return string The @type value.
     */
    public function get_type() {
        return 'BlogPosting';
    }

    /**
     * Determine if BlogPosting schema should be output.
     *
     * Only outputs when we have a post and schema_type is 'BlogPosting'.
     *
     * @return bool True if schema should be included.
     */
    public function is_needed(): bool {
        return $this->context->post instanceof \WP_Post
            && 'BlogPosting' === $this->context->schema_type;
    }
}
```

**Important notes:**
- Do NOT import Article_Schema - it's in the same namespace
- Do NOT override generate() - it inherits from Article_Schema
- The inherited generate() calls $this->get_type() which returns 'BlogPosting'
- Only override get_type() and is_needed()
  </action>
  <verify>
1. File exists: `includes/Schema/Types/class-blogposting-schema.php`
2. PHP syntax: `php -l includes/Schema/Types/class-blogposting-schema.php`
3. Structure: `grep -q "class BlogPosting_Schema extends Article_Schema"`
4. Type: `grep -q "return 'BlogPosting'"`
  </verify>
  <done>
- BlogPosting_Schema created extending Article_Schema
- get_type() returns 'BlogPosting'
- is_needed() checks schema_type === 'BlogPosting'
- Inherits all Article properties (author, wordCount, articleBody, etc.)
  </done>
</task>

<task type="auto">
  <name>Task 2: Create NewsArticle_Schema</name>
  <files>includes/Schema/Types/class-newsarticle-schema.php</files>
  <action>
Create NewsArticle_Schema extending Article_Schema. This adds news-specific properties: dateline and printSection.

**File structure:**
```php
<?php
/**
 * NewsArticle Schema class.
 *
 * Generates NewsArticle schema for news content.
 * Extends Article_Schema, adding dateline and printSection.
 *
 * @package Saman\SEO\Schema\Types
 * @since   1.0.0
 */

namespace Saman\SEO\Schema\Types;

if ( ! defined( 'ABSPATH' ) ) {
    exit;
}

/**
 * NewsArticle schema type.
 *
 * Outputs NewsArticle structured data with news-specific
 * properties like dateline and printSection.
 */
class NewsArticle_Schema extends Article_Schema {

    /**
     * Get the schema @type value.
     *
     * @return string The @type value.
     */
    public function get_type() {
        return 'NewsArticle';
    }

    /**
     * Determine if NewsArticle schema should be output.
     *
     * Only outputs when we have a post and schema_type is 'NewsArticle'.
     *
     * @return bool True if schema should be included.
     */
    public function is_needed(): bool {
        return $this->context->post instanceof \WP_Post
            && 'NewsArticle' === $this->context->schema_type;
    }

    /**
     * Generate NewsArticle schema.
     *
     * Extends Article schema with news-specific properties.
     *
     * @return array Schema.org NewsArticle structured data.
     */
    public function generate(): array {
        $schema = parent::generate();

        // Add dateline if available
        $dateline = $this->get_dateline();
        if ( ! empty( $dateline ) ) {
            $schema['dateline'] = $dateline;
        }

        // Add printSection if available
        $print_section = $this->get_print_section();
        if ( ! empty( $print_section ) ) {
            $schema['printSection'] = $print_section;
        }

        return $schema;
    }

    /**
     * Get the dateline for this news article.
     *
     * Tries post meta first, then auto-generates from Local SEO city.
     * Dateline format is typically "CITY, Date" (e.g., "WASHINGTON, Jan 23").
     *
     * @return string The dateline or empty string.
     */
    protected function get_dateline(): string {
        // Check post meta first
        $dateline = $this->context->meta['dateline'] ?? '';

        if ( empty( $dateline ) ) {
            // Auto-generate from Local SEO city
            $city = get_option( 'SAMAN_SEO_local_city', '' );
            if ( ! empty( $city ) ) {
                $dateline = strtoupper( $city ) . ', ' . get_the_date( 'M j', $this->context->post );
            }
        }

        return $dateline;
    }

    /**
     * Get the print section for this news article.
     *
     * Retrieved from post meta if set.
     *
     * @return string The print section or empty string.
     */
    protected function get_print_section(): string {
        return $this->context->meta['print_section'] ?? '';
    }
}
```

**Important notes:**
- Call parent::generate() to get all Article properties
- Add dateline and printSection only if they have values
- dateline can be auto-generated from SAMAN_SEO_local_city option
- printSection comes only from post meta (no auto-generation)
  </action>
  <verify>
1. File exists: `includes/Schema/Types/class-newsarticle-schema.php`
2. PHP syntax: `php -l includes/Schema/Types/class-newsarticle-schema.php`
3. Structure: `grep -q "class NewsArticle_Schema extends Article_Schema"`
4. Calls parent: `grep -q "parent::generate()"`
5. Has dateline: `grep -q "get_dateline"`
6. Has printSection: `grep -q "get_print_section"`
  </verify>
  <done>
- NewsArticle_Schema created extending Article_Schema
- get_type() returns 'NewsArticle'
- is_needed() checks schema_type === 'NewsArticle'
- generate() calls parent::generate() then adds news properties
- get_dateline() checks meta then auto-generates from city
- get_print_section() retrieves from meta
  </done>
</task>

<task type="auto">
  <name>Task 3: Register content schema types in plugin</name>
  <files>includes/class-saman-seo-plugin.php</files>
  <action>
Add Article, BlogPosting, and NewsArticle schema type registrations to the plugin's boot() method.

**Location:** In the `boot()` method, after the existing schema registrations (WebSite, Organization, Person, WebPage, Breadcrumb).

**Add these registrations:**
```php
// Content schemas (priority 15 - after WebPage 10, before Breadcrumb 20)
$registry->register(
    'article',
    Types\Article_Schema::class,
    [
        'label'      => 'Article',
        'post_types' => [ 'post' ],
        'priority'   => 15,
    ]
);

$registry->register(
    'blogposting',
    Types\BlogPosting_Schema::class,
    [
        'label'      => 'BlogPosting',
        'post_types' => [ 'post' ],
        'priority'   => 15,
    ]
);

$registry->register(
    'newsarticle',
    Types\NewsArticle_Schema::class,
    [
        'label'      => 'NewsArticle',
        'post_types' => [ 'post' ],
        'priority'   => 15,
    ]
);
```

**Important notes:**
- Add AFTER the WebPage registration (priority 10)
- Add BEFORE the Breadcrumb registration (priority 20)
- Use priority 15 for all content schemas
- post_types is ['post'] - these are for posts (users can extend via filter)
- The `Types\` prefix works because there's already a `use` statement for the Types namespace

**Check existing use statements.** If needed, add to the use block at top of file:
```php
use Saman\SEO\Schema\Types;
```

If the file uses individual imports like `use Saman\SEO\Schema\Types\WebPage_Schema;`, follow that pattern:
```php
use Saman\SEO\Schema\Types\Article_Schema;
use Saman\SEO\Schema\Types\BlogPosting_Schema;
use Saman\SEO\Schema\Types\NewsArticle_Schema;
```
  </action>
  <verify>
1. PHP syntax: `php -l includes/class-saman-seo-plugin.php`
2. Article registered: `grep -q "register.*article.*Article_Schema" includes/class-saman-seo-plugin.php`
3. BlogPosting registered: `grep -q "register.*blogposting.*BlogPosting_Schema" includes/class-saman-seo-plugin.php`
4. NewsArticle registered: `grep -q "register.*newsarticle.*NewsArticle_Schema" includes/class-saman-seo-plugin.php`
5. Priority 15: `grep -q "priority.*15" includes/class-saman-seo-plugin.php`
  </verify>
  <done>
- Article_Schema registered with slug 'article', priority 15
- BlogPosting_Schema registered with slug 'blogposting', priority 15
- NewsArticle_Schema registered with slug 'newsarticle', priority 15
- All have post_types ['post'] and come after WebPage, before Breadcrumb
  </done>
</task>

</tasks>

<verification>
After all tasks:

1. **BlogPosting_Schema:**
   - Extends Article_Schema
   - get_type() returns 'BlogPosting'
   - is_needed() checks schema_type === 'BlogPosting'

2. **NewsArticle_Schema:**
   - Extends Article_Schema
   - get_type() returns 'NewsArticle'
   - is_needed() checks schema_type === 'NewsArticle'
   - generate() adds dateline and printSection from parent

3. **Registration:**
   - All three types registered in Schema_Registry
   - Priority 15 places them after WebPage (10), before Breadcrumb (20)
   - post_types includes 'post'

4. **Syntax:** All modified PHP files pass `php -l` check
</verification>

<success_criteria>
- [ ] BlogPosting_Schema class exists extending Article_Schema
- [ ] NewsArticle_Schema class exists extending Article_Schema
- [ ] NewsArticle includes dateline getter with auto-generation fallback
- [ ] NewsArticle includes printSection getter from meta
- [ ] Article, BlogPosting, NewsArticle registered in plugin boot()
- [ ] All registrations use priority 15
- [ ] All PHP files pass syntax validation
- [ ] Schema type inheritance works (BlogPosting/NewsArticle inherit Article properties)
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-schemas/02-02-SUMMARY.md`
</output>
