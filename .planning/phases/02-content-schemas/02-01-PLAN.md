---
phase: 02-content-schemas
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - includes/Schema/Types/class-article-schema.php
autonomous: true

must_haves:
  truths:
    - "Post displays Article schema with full author Person object containing @type, @id, name, url"
    - "Article schema includes wordCount calculated from post content"
    - "Article schema includes articleBody excerpt (first ~150 words)"
    - "Article references WebPage via mainEntityOfPage @id"
    - "Article references publisher (Organization or Person) via @id"
  artifacts:
    - path: "includes/Schema/Types/class-article-schema.php"
      provides: "Article_Schema class extending Abstract_Schema"
      contains: "class Article_Schema extends Abstract_Schema"
      min_lines: 100
  key_links:
    - from: "includes/Schema/Types/class-article-schema.php"
      to: "Schema_IDs::article()"
      via: "get_id() override or generate()"
      pattern: "Schema_IDs::article"
    - from: "includes/Schema/Types/class-article-schema.php"
      to: "Schema_IDs::author()"
      via: "get_author() method"
      pattern: "Schema_IDs::author"
    - from: "includes/Schema/Types/class-article-schema.php"
      to: "context->schema_type"
      via: "is_needed() check"
      pattern: "schema_type.*Article"
---

<objective>
Create the Article_Schema base class with full author Person object, wordCount, and articleBody excerpt.

Purpose: Provides the foundation for all content schema types (Article, BlogPosting, NewsArticle). Google recommends full Person objects for author (not just name strings) and values wordCount and articleBody for rich results eligibility.

Output: `includes/Schema/Types/class-article-schema.php` - Complete Article schema that BlogPosting and NewsArticle will extend.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-content-schemas/02-RESEARCH.md

# Phase 1 foundation
@includes/Schema/class-abstract-schema.php
@includes/Schema/class-schema-context.php
@includes/Schema/class-schema-ids.php

# Example patterns from Phase 1
@includes/Schema/Types/class-webpage-schema.php
@includes/Schema/Types/class-person-schema.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Article_Schema base class</name>
  <files>includes/Schema/Types/class-article-schema.php</files>
  <action>
Create Article_Schema extending Abstract_Schema in `Saman\SEO\Schema\Types` namespace.

**File structure (follow WebPage_Schema pattern):**
```php
<?php
namespace Saman\SEO\Schema\Types;

use Saman\SEO\Schema\Abstract_Schema;
use Saman\SEO\Schema\Schema_IDs;

class Article_Schema extends Abstract_Schema {
    // Implementation
}
```

**Required methods:**

1. `get_type()` - Returns 'Article'

2. `is_needed(): bool` - Returns true when:
   - `$this->context->post instanceof \WP_Post`
   - AND `$this->context->schema_type === 'Article'`

3. `generate(): array` - Returns schema with:
   - `@type` => `$this->get_type()`
   - `@id` => `Schema_IDs::article($this->context->canonical)`
   - `headline` => `get_the_title($post)`
   - `datePublished` => `get_the_date(DATE_W3C, $post)`
   - `dateModified` => `get_the_modified_date(DATE_W3C, $post)`
   - `mainEntityOfPage` => `['@id' => Schema_IDs::webpage($this->context->canonical)]`
   - `author` => `$this->get_author()` (full Person object)
   - `publisher` => `$this->get_publisher_reference()` (@id reference)
   - `wordCount` => `$this->get_word_count()`
   - `articleBody` => `$this->get_article_body_excerpt()`
   - `image` => `$this->get_images()` (if featured image exists)

**Protected helper methods:**

4. `get_author(): array` - Build full Person object:
   ```php
   $author_id = (int) $this->context->post->post_author;
   if (!$author_id) return [];

   $author = [
       '@type' => 'Person',
       '@id'   => Schema_IDs::author($author_id),
       'name'  => get_the_author_meta('display_name', $author_id),
   ];

   // URL: prefer user_url, fallback to author posts URL
   $url = get_the_author_meta('user_url', $author_id);
   if (empty($url)) {
       $url = get_author_posts_url($author_id);
   }
   $author['url'] = $url;

   // Optional image from Gravatar
   $avatar = get_avatar_url($author_id, ['size' => 96]);
   if ($avatar) {
       $author['image'] = ['@type' => 'ImageObject', 'url' => $avatar];
   }

   return $author;
   ```

5. `get_publisher_reference(): array` - Return @id reference:
   ```php
   $type = get_option('SAMAN_SEO_homepage_knowledge_type', 'organization');
   if ('person' === $type) {
       return ['@id' => Schema_IDs::person()];
   }
   return ['@id' => Schema_IDs::organization()];
   ```

6. `get_word_count(): int` - Calculate word count:
   ```php
   $content = $this->context->post->post_content;
   $content = strip_shortcodes($content);
   $content = wp_strip_all_tags($content);
   return str_word_count($content);
   ```

7. `get_article_body_excerpt(): string` - Get excerpt:
   ```php
   $content = $this->context->post->post_content;
   $content = do_shortcode($content);  // Process shortcodes
   $content = wp_strip_all_tags($content);
   return wp_trim_words($content, 150, '...');
   ```

8. `get_images(): array` - Get featured image:
   ```php
   $image_url = get_the_post_thumbnail_url($this->context->post, 'full');
   if (empty($image_url)) {
       $image_url = get_option('SAMAN_SEO_default_og_image', '');
   }
   if (empty($image_url)) {
       return [];
   }
   return [
       '@type' => 'ImageObject',
       'url'   => $image_url,
   ];
   ```

**In generate(), only add optional properties if they have values:**
- Check `!empty($author)` before adding author
- Check `$word_count > 0` before adding wordCount
- Check `!empty($article_body)` before adding articleBody
- Check `!empty($images)` before adding image

**Important:**
- Follow existing docblock style from WebPage_Schema
- Do NOT add @context (Graph_Manager handles that)
- Use visibility: protected for helper methods so subclasses can override
  </action>
  <verify>
1. File exists: `includes/Schema/Types/class-article-schema.php`
2. PHP syntax check: `php -l includes/Schema/Types/class-article-schema.php`
3. Grep confirms required methods:
   - `grep -q "class Article_Schema extends Abstract_Schema"`
   - `grep -q "function is_needed"`
   - `grep -q "function get_author"`
   - `grep -q "Schema_IDs::article"`
   - `grep -q "Schema_IDs::author"`
  </verify>
  <done>
- Article_Schema class created with proper namespace
- is_needed() checks for post AND schema_type === 'Article'
- generate() returns full Article schema with all required properties
- Author is full Person object with @type, @id, name, url (and optional image)
- wordCount and articleBody calculated from post content
- Publisher references existing Organization/Person via @id
  </done>
</task>

</tasks>

<verification>
After task completion:

1. **Syntax:** `php -l includes/Schema/Types/class-article-schema.php` shows no errors
2. **Structure:** File contains class Article_Schema extending Abstract_Schema
3. **is_needed:** Method checks both post exists AND schema_type matches
4. **Author:** get_author() builds full Person with @type, @id, name, url
5. **Publisher:** get_publisher_reference() returns @id reference (not inline object)
6. **Content:** wordCount and articleBody calculated from stripped content
</verification>

<success_criteria>
- [ ] Article_Schema class exists in correct namespace
- [ ] is_needed() returns true only for posts with schema_type 'Article'
- [ ] generate() produces complete Article schema without @context
- [ ] Author is full Person object (not just name string)
- [ ] wordCount is integer from word count of stripped content
- [ ] articleBody is ~150 word excerpt
- [ ] Publisher is @id reference to Organization or Person
- [ ] PHP syntax validates without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-schemas/02-01-SUMMARY.md`
</output>
