---
phase: 05-admin-ui
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src-v2/pages/SearchAppearance.js
  - includes/Api/class-searchappearance-controller.php
autonomous: true

must_haves:
  truths:
    - "Search Appearance Content Types tab shows schema type dropdown for each post type"
    - "Selected schema type default is saved when user clicks Save"
    - "Schema_Context respects post type default from settings"
  artifacts:
    - path: "src-v2/pages/SearchAppearance.js"
      provides: "Schema type dropdown in post type settings"
      contains: "schema_type"
    - path: "includes/Api/class-searchappearance-controller.php"
      provides: "Settings save handler with schema_type"
      contains: "schema_type"
  key_links:
    - from: "src-v2/pages/SearchAppearance.js"
      to: "/saman-seo/v1/search-appearance/post-types"
      via: "apiFetch save"
      pattern: "apiFetch.*post-types"
    - from: "includes/Schema/class-schema-context.php"
      to: "SAMAN_SEO_post_type_seo_settings"
      via: "get_option"
      pattern: "get_option.*SAMAN_SEO_post_type_seo_settings"
---

<objective>
Wire schema type defaults in Search Appearance settings for post types.

Purpose: Allow users to set default schema type per post type (e.g., all Posts default to BlogPosting)
Output: Working schema type dropdown in Content Types settings that persists to options
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-admin-ui/05-RESEARCH.md

@src-v2/pages/SearchAppearance.js (lines 1-200 and grep for schema)
@includes/Api/class-searchappearance-controller.php
@includes/Schema/class-schema-context.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add schema_type to post type settings form</name>
  <files>src-v2/pages/SearchAppearance.js</files>
  <action>
The SearchAppearance.js already has `schemaTypeOptions` defined (lines 26-41) and uses `schema_itemtype` in Social Settings (lines 1057-1065). We need to add the same dropdown to the Content Types editing form.

Find the Content Types edit form section. It starts around line 640 (`{/* Content Types Tab */}`) and the editing form is inside `{editingPostType ? (` block.

Add the schema type dropdown in the post type editing form, after the existing fields. Look for where other settings like title template and description template are defined. Add:

```javascript
{/* Schema Type */}
<div className="form-row">
    <label>{__('Default Schema Type', 'saman-seo')}</label>
    <div>
        <select
            className="input"
            value={editingPostType.schema_type || ''}
            onChange={(e) => setEditingPostType({ ...editingPostType, schema_type: e.target.value })}
        >
            {schemaTypeOptions.map((opt) => (
                <option key={opt.value} value={opt.value}>{opt.label}</option>
            ))}
        </select>
        <p className="field-hint">{__('Schema type used for posts of this type unless overridden per-post', 'saman-seo')}</p>
    </div>
</div>
```

Place this BEFORE the "Show in Search Results" toggle (around line 760) - it's a content setting, not an indexing setting.

Also ensure that when loading post type data into editingPostType state, the schema_type field is included. Check the `handleEditPostType` or similar function that sets `editingPostType`.
  </action>
  <verify>
Search for schema_type in the file to confirm the change:
```bash
grep -n "schema_type" src-v2/pages/SearchAppearance.js
```

Should show multiple occurrences including the new Content Types dropdown.
  </verify>
  <done>
- Schema Type dropdown added to Content Types editing form
- Uses existing schemaTypeOptions array
- Properly wired to editingPostType state
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify backend saves schema_type</name>
  <files>includes/Api/class-searchappearance-controller.php</files>
  <action>
Read `includes/Api/class-searchappearance-controller.php` to understand how post type settings are saved.

Look for the endpoint that saves post type settings (likely `save_post_type` or `update_post_type` method). Verify that it:

1. Accepts `schema_type` in the request data
2. Saves it to the `SAMAN_SEO_post_type_seo_settings` option

If the backend already saves all fields generically (common pattern), no changes may be needed. The frontend sends the entire settings object and backend saves it.

If the backend whitelists specific fields, add `schema_type` to the whitelist/sanitization.

Check by looking at:
- The `save_post_type` or equivalent method
- Any sanitization/validation of post type settings
- The option key used (should be `SAMAN_SEO_post_type_seo_settings` per Schema_Context)

If changes are needed, add schema_type handling following the existing pattern for other string fields.
  </action>
  <verify>
Check that the option key matches what Schema_Context expects:
```bash
grep -n "SAMAN_SEO_post_type_seo_settings" includes/Api/class-searchappearance-controller.php
```

And verify Schema_Context reads from same option:
```bash
grep -n "SAMAN_SEO_post_type_seo_settings" includes/Schema/class-schema-context.php
```

Both should reference the same option key.
  </verify>
  <done>
- Backend saves schema_type to SAMAN_SEO_post_type_seo_settings option
- Schema_Context::determine_schema_type() reads from same option (already implemented in Phase 1)
- Full flow: UI -> API -> Option -> Schema_Context works end-to-end
  </done>
</task>

</tasks>

<verification>
1. npm run build completes without errors
2. Content Types tab in Search Appearance shows Schema Type dropdown
3. Selecting a schema type and saving persists the value
4. Creating a new post of that type shows the default schema in preview
5. Per-post override still takes precedence over post type default
</verification>

<success_criteria>
- Schema Type dropdown visible in Content Types settings for each post type
- Default schema type is saved when user saves post type settings
- New posts of that type use the configured default schema type
- Per-post schema_type override still takes precedence (verified in Schema_Context)
</success_criteria>

<output>
After completion, create `.planning/phases/05-admin-ui/05-03-SUMMARY.md`
</output>
